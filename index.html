<!doctype html>
<html lang=en>
  <head>
    <meta charset=utf-8>
    <meta name=viewport content='width=device-width, initial-scale=1' />
    <title>Library</title>
    <style>
      :root {
        --min-column-width: 250px;
        --max-content-width: 1024px;
        --space: 1rem;
        --half-space: calc(var(--space) / 2);
      }

      html {box-sizing: border-box;}
      *, *:before, *:after {box-sizing: inherit;}
      body {
        margin: var(--space);
        background: whitesmoke;
        font-family: sans-serif;
      }

      .content {
        display: grid;
        grid: none / repeat(auto-fit, minmax(var(--min-column-width), 1fr));
        grid-gap: var(--space);

        max-width: var(--max-content-width);
        margin: auto;
        list-style: none;
        padding: 0;
      }
      .cell {
        justify-self: center;
      }
      .media {
      }
      .title {
        display: block;
        padding: var(--half-space);
        font-weight: 550;
        text-align: center;
      }
      .title > a {color: black; text-decoration: none;}
      .cover {
        display: inline-block;
        background-repeat: no-repeat;
        position: relative;
        transform-origin: 0 0;
        border-radius: 3px;
        box-shadow: .5px .5px 1px 1px rgba(0, 0, 0, .15);
      }
    </style>
    <link rel=import href=data.yaml id=list>
  </head>
  <body>
    <ul class=content>
    </ul>
    <script src=node_modules/js-yaml/dist/js-yaml.min.js></script>
    <script>
      function format(template, item) {
        return Object.keys(item)
          .reduce((str, key) => str.replace(new RegExp(`{{${key}}}`, 'g'), item[key]), template)
      }

      fetch('data.yaml')
        .then(response => response.text())
        .then(jsyaml.safeLoad)
        .then(json => {
      // components can only be virtualized if you know their widths ahead of time so no autosizing (but preprocessing is possible)
      // data file, webpage, blob of js (embedded on that webpage), git versioning. if i had file system access, would this be easy?
      // todo: consider yaml or back to js for lighter wiehgt syntax
      // scale? some kind of max-width.
      // the cover project for games? libretro can do thumbnails. idk... i want them to look stellar but i also don't want to maintain these?
      // would prefer thumbnails be consistently sized actually, especially within a system.
      // filter sort reorder
      // todo: url should include assets/thumbnails/?
      // program, webpage, data, vcs-data
      const template = (json.template || '')
      function amazing (thing) {
        const base = Object.assign({url: '', x: 0, y: 0, width: 1, height: 1, rotate: 0, scale: 1}, thing.default && thing.default.image)
        console.log(base)
        thing.items.forEach(media => {
          if (media.items) return amazing(media)
          console.log(format(json.template, media))
          const cell = document.createElement('li')
          cell.className = 'cell'
          const mediaContainer = document.createElement('div')
          mediaContainer.className = 'media'
          const anchor = document.createElement('a')
          cell.appendChild(anchor)
          anchor.className = 'bar'
          anchor.href = media.app ? media.app : `${json.imageBaseURL || ''}/${media.images[0].url}`
          // trying to figure  out how to create an element inline and grow it
          // underneath another element so i can have a form thing where you keep
          // all the ui
          // anchor.onclick = () => {
          //   document
          // }
          const cover = document.createElement('div')
          const textAnchor = anchor.cloneNode()
          mediaContainer.appendChild(cover)
          anchor.appendChild(mediaContainer)
          const text = document.createElement('span')
          textAnchor.appendChild(document.createTextNode(media.title))
          text.appendChild(textAnchor)
          text.className = 'title'
          text.style.width = `${media.images[0].width}px`
          cell.appendChild(text)
          cover.className = 'cover'
          cover.style['background-image'] = `url(${json.thumbnailBaseURL || ''}/${media.images[0].url})`
          cover.style['background-position'] = `${media.images[0].x || base.x}px ${media.images[0].y || base.y}px`
          if (media.images[0].rotate % 360) {
            cover.style['transform'] = `rotate(${media.images[0].rotate || base.rotate}deg)`
          }
          if (media.images[0].scale) {
            cover.style['transform'] += ` scale(${media.images[0].scale || base.scale})`
          }
          if (media.images[0].rotate % 90 === 0 && media.images[0].rotate % 360) {
            cover.style.top = `${media.images[0].height || base.height}px`
            cover.style.width = `${media.images[0].height || base.width}px`
            cover.style.height = `${media.images[0].width || base.width}px`
          } else {
            cover.style.width = `${media.images[0].width || base.width}px`
            cover.style.height = `${media.images[0].height || base.height}px`
          }
          mediaContainer.style.width = `${media.images[0].width || base.width}px`
          mediaContainer.style.height = `${media.images[0].height || base.height}px`
          document.querySelector('.content').appendChild(cell)
        })
      }
      amazing(json)
    })
    </script>
  </body>
</html>
